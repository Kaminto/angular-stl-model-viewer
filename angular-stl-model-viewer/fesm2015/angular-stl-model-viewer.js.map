{"version":3,"file":"angular-stl-model-viewer.js","sources":["ng://angular-stl-model-viewer/lib/angular-stl-model-viewer.component.ts","ng://angular-stl-model-viewer/lib/angular-stl-model-viewer.module.ts","ng://angular-stl-model-viewer/public-api.ts","ng://angular-stl-model-viewer/angular-stl-model-viewer.ts"],"sourcesContent":["import {\n  Component,\n  ElementRef,\n  EventEmitter,\n  Input,\n  NgZone,\n  OnDestroy,\n  OnInit,\n  Output,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef\n} from '@angular/core'\n\nimport * as THREE from 'three'\n\nimport { STLLoader } from 'three/examples/jsm/loaders/STLLoader'\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls'\n\nimport { Vector3 } from 'three'\n\nexport interface MeshOptions {\n  castShadow?: boolean\n  position?: THREE.Vector3\n  receiveShadow?: boolean\n  scale?: THREE.Vector3\n  up?: THREE.Vector3\n  userData?: {[key: string]: any}\n  visible?: boolean\n}\n\nconst defaultMeshOptions = {\n  castShadow: true,\n  position: new THREE.Vector3(0, 0, 0),\n  receiveShadow: true,\n  scale: new THREE.Vector3(0.03, 0.03, 0.03)\n}\n\nfunction isWebGLAvailable() {\n  try {\n    const canvas = document.createElement('canvas')\n    return !! (window.WebGLRenderingContext && (canvas.getContext('webgl') || canvas.getContext( 'experimental-webgl')))\n  } catch (e) {\n    return false\n  }\n}\n\n@Component({\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  selector: 'stl-model-viewer',\n  styles: [`\n:host {\n  width: 100%;\n  height: 100%;\n  display: block;\n}\n  `],\n  template: ''\n})\nexport class StlModelViewerComponent implements OnInit, OnDestroy {\n  @Input() stlModels: string[] = []\n  @Input() hasControls = true\n  @Input() camera: THREE.PerspectiveCamera = new THREE.PerspectiveCamera(35, window.innerWidth / window.innerHeight, 1, 15)\n  @Input() cameraTarget: THREE.Vector3 = new THREE.Vector3( 0, 0, 0 )\n  @Input() light: THREE.Light = new THREE.PointLight( 0xffffff )\n  @Input() material: THREE.Material = new THREE.MeshPhongMaterial({ color: 0xc4c4c4, shininess: 100, specular: 0x111111 })\n  @Input() scene: THREE.Scene = new THREE.Scene()\n  @Input() renderer: THREE.WebGLRenderer = new THREE.WebGLRenderer({ antialias: true })\n  @Input() controls: any | null = null\n  @Input() meshOptions: MeshOptions[] = []\n\n  @Output() rendered = new EventEmitter<void>()\n\n  hasWebGL = isWebGLAvailable()\n  meshGroup = new THREE.Object3D()\n  isRendered = false\n  showStlModel = true\n  stlLoader = new STLLoader()\n\n  constructor(\n    private cdr: ChangeDetectorRef,\n    private eleRef: ElementRef,\n    private ngZone: NgZone\n  ) {\n    this.cdr.detach()\n    // default light position\n    this.light.position.set(1, 1, 2)\n\n    // default camera position\n    this.camera.position.set(3, 3, 3)\n\n    // default scene background\n    this.scene.background = new THREE.Color(0xffffff)\n\n    // default renderer options\n    this.renderer.setPixelRatio(window.devicePixelRatio)\n    this.renderer.shadowMap.enabled = true\n  }\n\n  ngOnInit() {\n    if (!this.hasWebGL) {\n      console.error('stl-model-viewer: Seems like your system does not support webgl.')\n      return\n    }\n\n    this.ngZone.runOutsideAngular(() => {\n      this.init()\n    })\n  }\n\n  ngOnDestroy() {\n    window.removeEventListener('resize', this.onWindowResize, false)\n\n    this.meshGroup.remove()\n\n    if (this.renderer) {\n      this.renderer.renderLists.dispose()\n      this.renderer.dispose()\n    }\n\n    if (this.camera) {\n      this.camera.remove()\n    }\n\n    if (this.light) {\n      this.light.remove()\n    }\n\n    if (this.material) {\n      this.material.dispose()\n    }\n\n    if (this.controls) {\n      this.controls.removeEventListener('change', this.render)\n      this.controls.dispose()\n    }\n\n    if (this.scene) {\n      this.scene.children.forEach((child) => {\n        this.scene.remove(child)\n      })\n      this.scene.dispose()\n    }\n  }\n\n  private async init() {\n    this.camera.add(this.light)\n    this.scene.add(this.camera)\n\n    // use default controls\n    if (this.hasControls && !this.controls) {\n      this.controls = new OrbitControls(this.camera, this.renderer.domElement)\n      this.controls.enableZoom = true\n      this.controls.minDistance = 1\n      this.controls.maxDistance = 7\n\n      this.controls.addEventListener('change', this.render)\n    }\n\n    window.addEventListener('resize', this.onWindowResize, false)\n\n    const meshCreations = this.stlModels.map((modelPath, index) => this.createMesh(modelPath, this.meshOptions[index]))\n    const meshes: THREE.Object3D[] = await Promise.all(meshCreations)\n\n    meshes.map((mesh) => this.meshGroup.add(mesh))\n    this.scene.add(this.meshGroup)\n    this.eleRef.nativeElement.appendChild(this.renderer.domElement)\n    this.setSizes()\n    this.render()\n    this.ngZone.run(() => {\n      this.isRendered = true\n      this.rendered.emit()\n      this.cdr.detectChanges()\n    })\n  }\n\n  async createMesh(path: string, meshOptions: MeshOptions = {}): Promise<THREE.Mesh> {\n    const geometry: THREE.BufferGeometry = await this.stlLoader.loadAsync(path)\n    const mesh = new THREE.Mesh(geometry, this.material)\n\n    const vectorOptions = ['position', 'scale', 'up']\n    const options = Object.assign({}, defaultMeshOptions, meshOptions)\n\n    Object.getOwnPropertyNames(options).forEach((option) => {\n      if (vectorOptions.indexOf(option) > -1) {\n        const vector = options[option] as Vector3\n        const meshVectorOption = mesh[option] as Vector3\n        meshVectorOption.set(vector.x, vector.y, vector.z)\n      } else {\n        mesh[option] = options[option]\n      }\n    })\n\n    return mesh\n  }\n\n  render = () => {\n    this.renderer.render(this.scene, this.camera)\n  }\n\n  setSizes() {\n    const width = this.eleRef.nativeElement.offsetWidth\n    const height = this.eleRef.nativeElement.offsetHeight\n\n    this.camera.aspect = width / height\n    this.camera.updateProjectionMatrix()\n\n    this.renderer.setSize(width, height)\n  }\n\n  onWindowResize = () => {\n    this.setSizes()\n    this.render()\n  }\n}\n","import { NgModule } from '@angular/core'\nimport { StlModelViewerComponent } from './angular-stl-model-viewer.component'\n\n@NgModule({\n  declarations: [StlModelViewerComponent],\n  exports: [StlModelViewerComponent],\n  imports: [\n  ]\n})\nexport class StlModelViewerModule { }\n","/*\n * Public API Surface of angular-stl-model-viewer\n */\n\nexport * from './lib/angular-stl-model-viewer.component'\nexport * from './lib/angular-stl-model-viewer.module'\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["THREE.Vector3","THREE.PerspectiveCamera","THREE.PointLight","THREE.MeshPhongMaterial","THREE.Scene","THREE.WebGLRenderer","THREE.Object3D","THREE.Color","THREE.Mesh"],"mappings":"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"}